<link rel="import" href="../polymer/polymer.html">

<dom-module id="simpla-text">
  <template>
    <style>
      :host, *, *::before, *::after {
        box-sizing: border-box;
      }

      :host {
        -moz-osx-font-smoothing: grayscale;
         -webkit-font-smoothing: antialiased;
                 font-smoothing: antialiased;

        outline: none;
      }

      .toolbar-wrapper {
        position: relative;
      }

      .toolbar {
        position: absolute;
      }
    </style>
    <div class="toolbar-wrapper">
      <simpla-text-toolbar
        id="toolbar"
        class="toolbar"
        on-command="_handleToolbarCommand"
        hidden>
      </simpla-text-toolbar>
    </div>
    <slot></slot>
  </template>

  <script>
    import editor from './behaviors/editor-connector';
    import inlineBlock from './behaviors/inline-block';
    import simpla from './behaviors/simpla-connector';
    import toolbar from './behaviors/toolbar';

    class SimplaText {
      beforeRegister() {
        this.properties = {
          editing: {
            type: Boolean,
            readOnly: true,
            value: false
          },

          editable: {
            type: Boolean,
            reflectToAttribute: true,
            value: false
          },

          plaintext: {
            type: Boolean,
            value: false
          }
        };

        this.listeners = {
          'tap': '_handleTap',
          'blur': '_handleBlur',
          'focus': '_handleFocus'
        };
      }

      get behaviors() {
        return [ editor, inlineBlock, simpla, toolbar ];
      }

      _handleBlur() {
        this._setEditing(false);
      }

      _handleFocus() {
        if (this.editable) {
          this._setEditing(true);
        }
      }

      _handleTap() {
        if (this.editable) {
          this._setEditing(true);
        }
      }

      _editableObserver(editable) {
        if (!editable) {
          this._setEditing(false);
        }
      }
    };

    Polymer(SimplaText)
  </script>
</dom-module>
