<link rel="import" href="../polymer/polymer.html"> <dom-module id="simpla-text"> <template> <style>*,::after,::before,:host{box-sizing:border-box}:host{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-smoothing:antialiased;outline:0}.toolbar-wrapper{position:relative}.toolbar{position:absolute}</style> <div class="toolbar-wrapper"> <simpla-text-toolbar id="toolbar" class="toolbar" on-command="_handleToolbarCommand" hidden> </simpla-text-toolbar> </div> <slot></slot> </template> <script>!function(){"use strict";var e="simpla-text-editor.html",t={properties:{commands:{type:Array,computed:"_computeCommands(plaintext)"}},observers:["_checkEditorPrepped(editable, commands, inline)"],getEditor:function(){var e=this;return Promise.resolve(this._editor||this._createEditor()).then(function(t){return e._editor=t,t})},runCommand:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getEditor().then(function(i){return i.runCommand(e,t)})},_createEditor:function(){var t=this;return this.__waitForEditor||(this.__waitForEditor=new Promise(function(i,n){var r=t.resolveUrl(e);t.importHref(r,i,n)}).then(function(){var e=window.SimplaText.Editor,i=function(t){return e.formatters[t]};return new e({dom:t,inline:t.inline,formatters:t.commands.map(i),formatterChangedCallback:function(e,i){t.fire("command-changed",{name:e.name,applied:i.applied,meta:i.meta})},selectCallback:function(e){return t.fire("select",{selection:e})},inputCallback:function(){return t.fire("input")},editableCallback:function(){return t.editable}})})),this.__waitForEditor},_checkEditorPrepped:function(e){e&&this.getEditor()},_computeCommands:function(e){return e?[]:["bold","italic","underline"]}},i=["h1","h2","h3","h4","h5","h6","p","li","dd","figcaption","mark","q","s","time","u","legend","option","b","big","i","small","tt","abbr","acronym","cite","pre","code","dfn","em","kbd","strong","samp","var","a","span","sub","sup","button","label"],n={properties:{inline:{type:Boolean,observer:"_inlineObserver"},block:{type:Boolean,observer:"_blockObserver"}},attached:function(){this._autoSetMode()},_inlineObserver:function(e){this.block=!e},_blockObserver:function(e){this.inline=!e},_autoSetMode:function(){var e=this.parentElement&&this.parentElement.nodeName.toLowerCase();"undefined"==typeof this.inline&&"undefined"==typeof this.block&&(this.inline=i.indexOf(e)!==-1)}},r={properties:{editable:{type:Boolean,reflectToAttribute:!0,value:function(){return Simpla.getState("editable")}},uid:{type:String,observer:"_observeUid"}},listeners:{input:"_setToSimpla"},attached:function(){var e=this;this._observers={editable:Simpla.observeState("editable",function(t){e.editable=t})},this.uid&&this._attachUidObserver(),this._attached=!0},detached:function(){var e=this;Object.keys(this._observers||{}).map(function(t){return e._observers[t]}).forEach(function(e){return e.unobserve()})},_observeUid:function(e){var t=this;this._attached&&e&&(Simpla.get(e).then(function(e){return t._restoreFromSimpla(e)}),this._attachUidObserver())},_attachUidObserver:function(){var e=this;this._observers.uid&&this._observers.uid.unobserve(),this._observers.uid=Simpla.observe(this.uid,function(t){return e._restoreFromSimpla(t)})},_restoreFromSimpla:function(e){var t=void 0;e&&(t=e.data,this.innerHTML!==t.html&&(this.innerHTML=t.html))},_setToSimpla:function(){this.uid&&Simpla.set(this.uid,{type:"Text",data:{html:this.innerHTML}})}},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)},l={listeners:{select:"_updateToolbarFromSelect","command-changed":"_updateCommands",blur:"_hideToolbar"},_hideToolbar:function(){this.$.toolbar.hidden=!0},_handleToolbarCommand:function(e){var t=e.detail,i=t.name,n=t.options,r=void 0===n?{}:n;this.runCommand(i,r)},_updateToolbarFromSelect:function(e){var t=e.detail.selection;return this.plaintext?void(this.$.toolbar.hidden=!0):(this.$.toolbar.hidden=!t,void this.$.toolbar.hoverOverSelection(t))},_updateCommands:function(e){var t=e.detail,i=t.name,n=t.applied,r=this.$.toolbar;n?r.activeTools=[].concat(s(r.activeTools),[i]):r.activeTools=r.activeTools.filter(function(e){return e!==i})}},u=function(){function e(){o(this,e)}return a(e,[{key:"beforeRegister",value:function(){this.properties={editing:{type:Boolean,readOnly:!0,value:!1},editable:{type:Boolean,reflectToAttribute:!0,value:!1},plaintext:{type:Boolean,value:!1}},this.listeners={tap:"_handleTap",blur:"_handleBlur",focus:"_handleFocus"}}},{key:"_handleBlur",value:function(){this._setEditing(!1)}},{key:"_handleFocus",value:function(){this.editable&&this._setEditing(!0)}},{key:"_handleTap",value:function(){this.editable&&this._setEditing(!0)}},{key:"_editableObserver",value:function(e){e||this._setEditing(!1)}},{key:"behaviors",get:function(){return[t,n,r,l]}},{key:"value",get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}}]),e}();Polymer(u)}()</script> </dom-module> 