<link rel="import" href="../polymer/polymer.html"> <dom-module id="simpla-text"> <template> <style>:host{display:block}:host([contenteditable]){outline:0}:host([inline]){display:inline}</style> <slot></slot> </template> <script>!function(){"use strict";var e="simpla-text-editor.html",t=document.createElement("simpla-text-toolbar"),i={properties:{commands:{type:Array,computed:"_computeCommands(plaintext)"}},observers:["_checkEditorPrepped(editable, commands, inline)"],getEditor:function(){var e=this;return Promise.resolve(this._editor||this._createEditor()).then(function(t){return e._editor=t,t})},runCommand:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getEditor().then(function(i){return i.runCommand(e,t)})},_createEditor:function(){var i=this;return this.__waitForEditor||(this.__waitForEditor=new Promise(function(t,n){var r=i.resolveUrl(e);i.importHref(r,t,n)}).then(function(){var e=window.SimplaText,n=e.Editor,r=e.formatters,o=function(e){return r[e]};return new n({dom:i,inline:i.inline,formatters:i.commands.map(o),placeholder:i.placeholder,formatterChangedCallback:function(e,n){var r=e.name,o=n.applied,a=n.meta;i.getEditor().then(function(e){t.target===e&&(i._tools=i._tools||{},i._tools[r]={applied:o,meta:a},t.set?(t.set("tools."+r+".active",o),t.set("tools."+r+".meta",a)):(t.tools=t.tools||{},t.tools[r]={applied:o,meta:a}))})},selectCallback:function(e){i.fire("select",{selection:e}),t.parentElement!==document.body&&document.body.appendChild(t),t.range=e&&e.rangeCount&&e.getRangeAt(0),i._tools&&(t.tools=i._tools),e&&i.getEditor().then(function(e){t.target=e})},inputCallback:function(){return i.fire("input")},editableCallback:function(){return i.editable}})})),this.__waitForEditor},_checkEditorPrepped:function(e){e&&this.getEditor()},_computeCommands:function(e){return e?[]:["bold","italic","underline","link"]}},n=["h1","h2","h3","h4","h5","h6","p","li","dd","figcaption","mark","q","s","time","u","legend","option","b","big","i","small","tt","abbr","acronym","cite","pre","code","dfn","em","kbd","strong","samp","var","a","span","sub","sup","button","label"],r={properties:{inline:{type:Boolean,reflectToAttribute:!0}},attached:function(){this._autoSetMode()},_autoSetMode:function(){var e=this.parentElement&&this.parentElement.nodeName.toLowerCase();"undefined"==typeof this.inline&&(this.inline=n.indexOf(e)!==-1)}},o={properties:{editable:{type:Boolean,reflectToAttribute:!0},uid:{type:String,observer:"_observeUid"}},listeners:{input:"_setToSimpla"},attached:function(){this._attached=!0,this._observers={editable:this._observeAndInitEditable(),uid:this.uid&&this._observeAndInitUid()}},detached:function(){var e=this;this._attached=!1,Object.keys(this._observers||{}).forEach(function(t){return e._observers[t]&&e._observers[t].unobserve()})},_observeAndInitEditable:function(){var e=this;return"undefined"==typeof this.editable&&(this.editable=Simpla.getState("editable")),Simpla.observeState("editable",function(t){e.editable=t})},_observeAndInitUid:function(){var e=this,t=function(t){return e._restoreFromSimpla(t)};return Simpla.get(this.uid).then(t),Simpla.observe(this.uid,t)},_observeUid:function(e){this._attached&&(this._observers.uid&&this._observers.uid.unobserve(),e&&(this._observers.uid=this._observeAndInitUid()))},_restoreFromSimpla:function(e){e&&this.innerHTML!==e.data.text&&(this.innerHTML=e.data.text)},_setToSimpla:function(){this.uid&&Simpla.set(this.uid,{type:"Text",data:{text:this.innerHTML}})}},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function(){function e(){a(this,e)}return s(e,[{key:"beforeRegister",value:function(){this.is="simpla-text",this.properties={editing:{type:Boolean,readOnly:!0,value:!1},editable:{type:Boolean,reflectToAttribute:!0},plaintext:{type:Boolean,value:!1},placeholder:{type:String,value:"Enter your text..."}},this.listeners={tap:"_handleTap",blur:"_handleBlur",focus:"_handleFocus"}}},{key:"_handleBlur",value:function(){this._setEditing(!1)}},{key:"_handleFocus",value:function(){this.editable&&this._setEditing(!0)}},{key:"_handleTap",value:function(){this.editable&&this._setEditing(!0)}},{key:"_editableObserver",value:function(e){e||this._setEditing(!1)}},{key:"behaviors",get:function(){return[i,r,o]}},{key:"value",get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}}]),e}();Polymer(l)}()</script> </dom-module> 